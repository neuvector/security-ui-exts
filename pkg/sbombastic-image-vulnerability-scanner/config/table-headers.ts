import { elapsedTime } from "@shell/utils/time";

export const REGISTRY_SCAN_TABLE = [
  {
    name: "registry",
    labelKey: "imageScanner.registries.registrytable.header.registry",
    value: "metadata.name",
    sort: "registry",
    formatter: "RegistryNameCell",
  },
  {
    name: "namespace",
    labelKey: "imageScanner.registries.registrytable.header.namespace",
    value: "metadata.namespace",
    sort: "namespace",
  },
  {
    name: "uri",
    labelKey: "imageScanner.registries.registrytable.header.uri",
    value: "spec.uri",
    sort: "uri",
  },
  {
    name: "repositories",
    labelKey: "imageScanner.registries.registrytable.header.repos",
    value: "spec.repositories",
    sort: "repositories",
  },
  {
    name: "scanInterval",
    labelKey: "imageScanner.registries.registrytable.header.schedule",
    value: "spec.scanInterval",
    getValue: (row: any) => elapsedTime(row.scanInterval * 3600 * 1000).label,
    sort: "scanInterval",
  },
  {
    name: "status",
    labelKey: "imageScanner.registries.registrytable.header.status",
    value: "currStatus",
    formatter: "RegistryStatusCellBadge",
    sort: "status",
    width: 100,
  },
  {
    name: "progress",
    labelKey: "imageScanner.registries.registrytable.header.progress",
    getValue: (row: any) => row,
    formatter: "ProgressCell",
    sort: "progress",
    width: 120,
  },
  {
    name: "previousScan",
    labelKey: "imageScanner.registries.registrytable.header.prevScan",
    getValue: (row: any) => row,
    formatter: "PreviousScanCell",
    sort: "previousScan",
    width: 200,
  },
];

export const REGISTRY_SCAN_HISTORY_TABLE = [
  {
    name: "status",
    labelKey: "imageScanner.registries.configuration.scanTable.header.status",
    value: "status.statusResult.type",
    formatter: "RegistryStatusCellBadge",
    sort: "status.statusResult.type",
    width: 100,
  },
  {
    name: "since",
    labelKey: "imageScanner.registries.configuration.scanTable.header.since",
    value: "status.statusResult.lastTransitionTime",
    formatter: "Date",
    sort: "status.statusResult.lastTransitionTime:desc",
  },
  {
    name: "progress",
    labelKey: "imageScanner.registries.configuration.scanTable.header.progress",
    getValue: (row: any) => row,
    formatter: "Progress",
    sort: "progress",
  },
  {
    name: "imagesScanned",
    labelKey:
      "imageScanner.registries.configuration.scanTable.header.imagesScanned",
    value: "status.scannedImagesCount",
    sort: "status.scannedImagesCount",
  },
  {
    name: "imagesFound",
    labelKey:
      "imageScanner.registries.configuration.scanTable.header.imagesFound",
    value: "status.imagesCount",
    sort: "status.imagesCount",
  },
  {
    name: "errors",
    labelKey: "imageScanner.registries.configuration.scanTable.header.error",
    value: "status.statusResult.message",
    formatter: "ScanErrorCell",
    sort: "errors",
    width: 150,
  },
];

export const VEX_MANAGEMENT_TABLE = [
  {
    name: "_status",
    labelKey: "imageScanner.vexManagement.table.headers.status",
    value: "spec.enabled",
    formatter: "VexStatusCellBadge",
    sort: "spec.enabled",
  },
  {
    name: "name",
    labelKey: "imageScanner.vexManagement.table.headers.name",
    value: "metadata.name",
    formatter: "VexNameLink",
    sort: "metadata.name",
  },
  {
    name: "uri",
    labelKey: "imageScanner.vexManagement.table.headers.uri",
    value: "spec.url",
    formatter: "UriExternalLink",
    sort: "spec.url",
  },
  {
    name: "createdBy",
    labelKey: "imageScanner.vexManagement.table.headers.createdBy",
    value: (row: any) => {
      const gen = Number(row?.metadata?.generation);
      return gen === 1 ? "Rancher" : "Manual entry";
    },
    sort: "metadata.generation",
  },
  {
    name: "updated",
    labelKey: "imageScanner.vexManagement.table.headers.updated",
    value: (row: any) => row?.metadata?.creationTimestamp || "",
    formatter: "VexDateFormatter",
    sort: "metadata.creationTimestamp",
  },
];

export const IMAGE_LIST_TABLE = [
  {
    name: "name",
    labelKey: "imageScanner.images.listTable.headers.imageName",
    value: "metadata.name",
    formatter: "ImageNameCell",
    sort: "metadata.name",
  },
  {
    name: "cves",
    labelKey: "imageScanner.images.listTable.headers.identifiedCVEs",
    value: "spec.scanResult",
    formatter: "IdentifiedCVEsCell",
    sort: "spec.scanResult",
    width: 300,
  },
  {
    name: "repository",
    labelKey: "imageScanner.images.listTable.headers.repository",
    value: "spec.repository",
    sort: "spec..repository",
  },
  {
    name: "registry",
    labelKey: "imageScanner.images.listTable.headers.registry",
    value: "spec.registry",
    sort: "spec.registry",
  },
];

export const REPO_BASED_TABLE = [
  {
    name: "repository",
    labelKey: "imageScanner.images.listTable.headers.repository",
    value: "repository",
    sort: "repository",
    width: 200,
  },
  {
    name: "cves",
    labelKey: "imageScanner.images.listTable.headers.vulnerabilities",
    value: "cveCntByRepo",
    formatter: "IdentifiedCVEsPercentageCell",
    sort: "cveCntByRepo",
    width: 300,
  },
  {
    name: "registry",
    labelKey: "imageScanner.images.listTable.headers.registry",
    value: "registry",
    sort: "registry",
    width: 450,
  },
];

export const REPO_BASED_IMAGE_LIST_TABLE = [
  {
    name: "",
    value: "",
    sort: "",
    width: 60,
  },
  {
    name: "image",
    labelKey: "imageScanner.images.listTable.headers.imageName",
    formatter: "ImageNameCell",
    sort: "metadata.name",
    width: 200,
  },
  {
    name: "cves",
    labelKey: "imageScanner.images.listTable.headers.identifiedCVEs",
    value: "scanResult",
    formatter: "IdentifiedCVEsCell",
    sort: "imageScanner",
    width: 310,
  },
  {
    name: "",
    value: "",
    sort: "",
    width: 450,
  },
];

export const VULNERABILITIES_TABLE = [
  {
    name: "cve",
    labelKey: "imageScanner.vulnerabilities.table.headers.cve",
    value: "metadata.name",
    sort: "metadata.name",
    width: 140,
  },
  {
    name: "score",
    labelKey: "imageScanner.vulnerabilities.table.headers.score",
    value: "spec.scoreV3",
    formatter: "ScoreBadgeCell",
    sort: "spec.scoreV3",
    width: 100,
  },
  {
    name: "affectedImages",
    labelKey: "imageScanner.vulnerabilities.table.headers.affectedImages",
    value: "spec.impactedImages",
    formatter: "ImpactedCell",
    formatterParams: { ticks: 23 },
    sort: "spec.impactedImages",
    width: 200,
  },
  {
    name: "severity",
    labelKey: "imageScanner.vulnerabilities.table.headers.severity",
    value: "spec.severity",
    sort: "spec.severity",
    width: 120,
  },
  {
    name: "identifiedImages",
    labelKey: "imageScanner.vulnerabilities.table.headers.identifiedImages",
    value: "spec.identifiedImages",
    formatter: "ImpactedCell",
    formatterParams: { ticks: 45 },
    sort: "spec.identifiedImages",
    width: 300,
  },
];
