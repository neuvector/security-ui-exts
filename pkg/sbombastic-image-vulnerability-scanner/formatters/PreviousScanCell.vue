<script>
import ProgressCell from "@sbombastic-image-vulnerability-scanner/formatters/ProgressCell";
export default {
  props: {
    value: {
      type:    String,
      required: true
    },
    row: {
      type: Object,
      required: true
    }
  },
  methods: {
    getStatusStyle(row) {
      if (row && row.scanjobs[1] && row.scanjobs[1].status && row.scanjobs[1].status.statusResult && row.scanjobs[1].status.statusResult.type) {
        return { color: 'var(--text-secondary)' };
      } else {
        return { color: 'var(--text-muted)' };
      }
    },
    getStatusText(row) {
      if (row && row.scanjobs[1] && row.scanjobs[1].status && row.scanjobs[1].status.statusResult && row.scanjobs[1].status.statusResult.type) {
        return this.t(`imageScanner.enum.status.${row.scanjobs[1].status.statusResult.type.toLowerCase()}`);
      } else {
        return this.t('imageScanner.enum.status.none');
      }
    }
  }
};
</script>

<template>
    <div v-if="row && row.scanjobs[1] && row.scanjobs[1].status && row.scanjobs[1].status.statusResult && row.scanjobs[1].status.statusResult.type" class="previous-scan-cell">
        <div class="dot" :class="row.scanjobs[1].status.statusResult.type.toLowerCase()"></div>
        <div class="status" :style="getStatusStyle(row)">{{ getStatusText(row) }}</div>  
        <div v-if="row.scanjobs[1].status.statusResult.progress">
          <ProgressCell :status="row.scanjobs[1].status.statusResult" />
        </div>
    </div>
    <div v-else class="previous-scan-cell">
      <div class="dot pending"></div>
      <div class="status" style="color: var(--text-secondary)">{{ t('imageScanner.enum.status.pending') }}</div>  
    </div>
</template>

<style lang="scss" scoped>
    .previous-scan-cell {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        font-size: 14px;
        .status {
            font-size: 14px;
        }
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            border-width: 1px;
            border-style: solid;
            display: inline-block; 
            &.pending {
                background-color: var(--status-pending);
                border-color: var(--status-pending);
            }
            &.scheduled {
                background-color: var(--status-scheduled);
                border-color: var(--status-scheduled);
            }
            &.inprogress {
                background-color: var(--status-inprogress);
                border-color: var(--status-inprogress);
            }
            &.complete {
                background-color: var(--status-complete);
                border-color: var(--status-complete);
            }
            &.failed {
                background-color: var(--status-failed);
                border-color: var(--status-failed);
            }
            &.none {
                background-color: var(--status-none);
                border-color: #DCDEE4;
            }

            --status-pending: #DCDEE7;
            --status-scheduled: #0FCFF0;
            --status-inprogress: #3D98D3;
            --status-complete: #5BB04F;
            --status-failed: #DE2136;
            --status-none: #FFFFFF;
        }
    }
</style>
