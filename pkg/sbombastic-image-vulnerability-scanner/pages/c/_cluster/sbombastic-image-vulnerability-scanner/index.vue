<script>
import Dashboard from '@pkg/pages/c/_cluster/sbombastic-image-vulnerability-scanner/Dashboard';
import Installation from '@pkg/pages/c/_cluster/sbombastic-image-vulnerability-scanner/Installation';
import { SERVICE, SCHEMA } from '@shell/config/types';
import { RESOURCE } from '@pkg/types';

export default {
  name: 'Entry',

  components: { Dashboard, Installation },

  async fetch() {
    console.log("Entry fetch")
    if ( this.$store.getters['cluster/canList'](SERVICE) ) {
      this.allServices = await this.$store.dispatch('cluster/findAll', { type: SERVICE }, { root: true });
    }
    if ( this.$store.getters['cluster/canList'](SCHEMA) ) {
      this.allSchemas = await this.$store.dispatch('cluster/findAll', { type: SCHEMA }, { root: true });
    }
  },

  data() {
    return {
      allServices: null,
      allSchemas: null,
      index: -1,
    }
  },

  computed: {
    hasSchema() {
      return this.$store.getters['cluster/schemaFor'](RESOURCE.REGISTRY);
    },
  }
};
</script>

<template>
  <div v-if="allSchemas">
    <Installation v-if="!hasSchema" />
    <Dashboard v-else/>
  </div>
</template>
